---
title: "Single Peptide Results Analysis - UPS Dataset"
output:
  html_document:
    df_print: paged
---

*Ray Sajulga*

**September 17, 2018**

# Introduction
Analysis adapted from Caleb Easterly's "Single Peptide Results Analysis" for the UPS dataset.

## Packages
```{r}
install.packages("dplyr")
install.packages("pander")
```

```{r}
library(dplyr)
library(stringr)
library(pander)
```

# Peptide Sampling
Let's randomly select 10 UPS peptides and 10 non-UPS peptides from the UPS1 dataset (replicate #3):

```{r}

# Obtains peptide report
peptide_report <- read.csv("Data/UPS/UPS1/UPS1_03-Peptide_Shaker_on_data_23__Peptide_Report.tabular",
         sep = "\t", comment.char="", header = TRUE) %>%
  select(proteins = Protein.s.,
         sequence = Sequence)

# Splits into UPS peptides and non-UPS peptides
ups_peptides <- filter(peptide_report, grepl("ups", proteins))
non_ups_peptides <- filter(peptide_report, !grepl("ups", proteins))

# Randomly selects 10 from each category
set.seed(42)
ups_peps_20 <- ups_peptides[sample(nrow(ups_peptides), 10),]
non_ups_peps_20 <- non_ups_peptides[sample(nrow(non_ups_peptides), 10),]
twenty_peps <- rbind(ups_peps_20, non_ups_peps_20)
set.seed(24)
fivepep <- twenty_peps[sample(20,5),]
#five_peps
fivepep <- fivepep$sequence

# Concatenates the two categories and writes it out in a text file for analysis
write.table(twenty_peps$sequence, "twenty_peptides.txt", 
            sep="\n", quote=FALSE, row.names=FALSE, col.names=FALSE)

```

### Unipept

#### Process
- Paste the tabular list of peptides into the Unipept *Metaproteomics Analysis* web application (https://morty.ugent.be/mpa)

```{r}
cov_pat <- "\ \\(.{3,4}\\)"
uni <- read.csv('results/unipept/UPS2_04-Unipept-20pep-42seed.csv',
                stringsAsFactors = FALSE) %>%
    select(peptide,
           uni_go_bp = GO..biological.process.,
           uni_go_mf = GO..molecular.function.,
           uni_go_cc = GO..cellular.component.) %>%
    filter(peptide %in% fivepep) %>%
    mutate(uni_go_bp = str_replace_all(string = uni_go_bp, pattern = cov_pat, replacement = ""),
           uni_go_mf = str_replace_all(string = uni_go_mf, pattern = cov_pat, replacement = ""),
           uni_go_cc = str_replace_all(string = uni_go_cc, pattern = cov_pat, replacement = ""))
uni
```



### eggNOG mapper
- Use the Galaxy version of eggNOG mapper, on Galaxy-P
- Parameters:
  + Taxonomic Scope: Mammals
  
```{r}
em <- read.delim("results/eggNOG/eggnog_mapper_20_sequences_results.tabular",
                 stringsAsFactors = FALSE,
                 header=FALSE) %>%
    select(peptide = V1, em_prot = V2, em_go = V6, em_gene = V5, em_descript = V13) %>%
    filter(peptide %in% fivepep) %>%
    mutate(em_go = str_replace_all(em_go, pattern = ",", replacement = "; "))
em
```

### MetaGOmics



### Combine all of the results:
```{r}
all_results <- plyr::join_all(list(em, uni), by = "peptide")
```

All of the results are below:

```{r}
library(pander)
knitr:kable(all_results)
```
